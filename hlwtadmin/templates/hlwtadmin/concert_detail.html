{% extends "base_generic.html" %}

{% block content %}
    {% if concert.cancelled %}<h1 style="text-decoration: line-through;">{% else %}<h1>{% endif %}
        {% block title %}Concert: {{ concert.title }}{% endblock %}
        {% if concert.verified %}{% load static %}<img style="width: 25px; border: 0px; margin-left: 1px; margin-right: 1px;" src="{% static 'icons/verified.svg' %}" alt="verified" />{% endif %}
    </h1>

    <div style="margin-left:20px;margin-top:20px">
        <table border="1">
            <tr>
                <td>Datum</td>
                <td>{{ concert.date }}</td>
            </tr>
            <tr>
                <td>Genre</td>
                <td>{{ concert.genre.all|join:","}}</td>
            </tr>
            <tr>
                <td>GPS</td>
                <td>{{ concert.latitude }}, {{ concert.longitude }}</td>
            </tr>
        </table>
    </div>

    <div style="margin-left:20px;margin-top:20px">
        <h4>Artists</h4>
        <ul>
            {% for relation in concert.relationconcertartist_set.all %}
              <li>
                  <a href="{% url 'artist_detail' relation.artist.mbid %}">{{ relation.artist.name }}</a>
                  {% if relation.artist_credited_as %}(credited as "{{ relation.artist_credited_as }}"){% endif %}
                  {% if perms.hlwtadmin.can_update_relationconcerartist %}<a href="{% url 'relationconcertartist_update' relation.id %}">{% load static %}<img src="{% static 'icons/edit.png' %}" alt="edit" /></a>{% endif %}
                  {% if perms.hlwtadmin.can_delete_relationconcerartist %}<a href="{% url 'relationconcertartist_delete' relation.id concert.id %}">{% load static %}<img src="{% static 'icons/erase.png' %}" alt="delete" /></a>{% endif %}
              </li>
            {% endfor %}
        </ul>
    </div>

    <div style="margin-left:20px;margin-top:20px">
        <h4>Organisations</h4>
        <ul>
            {% for relation in concert.relationconcertorganisation_set.all %}
                <li>
                    {{ relation.relation_type.all|join:"," }}
                    {% if relation.organisation%}
                        <a href="{% url 'organisation_detail' relation.organisation.pk %}">{{ relation.organisation.name }}</a>
                    {% else %}
                      Missing organisation
                    {% endif %}
                    {% if relation.organisation_credited_as %}(credited as "{{ relation.organisation_credited_as }}"){% endif %}
                    {% if relation.organisation.location %} in <a href="{% url 'location_detail' relation.organisation.location.id %}">{{ relation.organisation.location }}</a> {% load static %}<img style="width: 16px; height: 16px; border: 0px; margin-left: 1px; margin-right: 1px;" src="{% static 'flags/' %}{{ relation.organisation.location.country.iso_code }}.png" />{% endif %}
                    {% if perms.hlwtadmin.can_update_relationconcertorganisation %}<a href="{% url 'relationconcertorganisation_update' relation.id %}">{% load static %}<img src="{% static 'icons/edit.png' %}" alt="edit" /></a>{% endif %}
                    {% if perms.hlwtadmin.can_delete_relationconcertorganisation %}<a href="{% url 'relationconcertorganisation_delete' relation.id concert.id %}">{% load static %}<img src="{% static 'icons/erase.png' %}" alt="delete" /></a>{% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>

    {% if concert.concerta.all or concert.concertb.all %}
    <div style="margin-left:20px;margin-top:20px">

        <h4>Related concerts</h4>
        <ul>
            {% for relation in concert.concerta.all %}
              <li>
                  {{ concert.title }} {{ relation.relation_type.all|join:" and " }} <a href="{{ relation.concert_b.id }}">{{ relation.concert_b.title }}</a>
                  {% if perms.hlwtadmin.can_update_relationconcertconcert %}<a href="{% url 'relationconcertconcert_update' relation.id %}">{% load static %}<img src="{% static 'icons/edit.png' %}" alt="edit" /></a>{% endif %}
                  {% if perms.hlwtadmin.can_delete_relationconcertconcert %}<a href="{% url 'relationconcertconcert_delete' relation.id concert.id %}">{% load static %}<img src="{% static 'icons/erase.png' %}" alt="delete" /></a>{% endif %}
              </li>
            {% endfor %}
            {% for relation in concert.concertb.all %}
              <li>
                  Inverted relation: <a href="{{ relation.concert_a.id }}">{{ relation.concert_a.title }}</a> {{ relation.relation_type.all|join:", " }} {{ concert.title }}
                  {% if perms.hlwtadmin.can_update_relationconcertconcert %}<a href="{% url 'relationconcertconcert_update' relation.id %}">{% load static %}<img src="{% static 'icons/edit.png' %}" alt="edit" /></a>{% endif %}
                  {% if perms.hlwtadmin.can_delete_relationconcertconcert %}<a href="{% url 'relationconcertconcert_delete' relation.id concert.id %}">{% load static %}<img src="{% static 'icons/erase.png' %}" alt="delete" /></a>{% endif %}
              </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <hr>

        {% if concert.concertannouncement_set.all %}
    <div style="margin-left:20px;margin-top:20px">
        <h4>Based on</h4>
        <table border="1">
            <tr>
                <th>Gigfinder</th>
                <th>Concertannouncement</th>
                <th>Venue</th>
                <th>GPS</th>
                <th>Organisation</th>
            </tr>
            {% for relation in concert.concertannouncement_set.all %}
                <tr>
                    <td>
                        <a target="_blank" href="{{ relation.gigfinder.base_url}}{{ relation.gigfinder_concert_id }}">
                        {% load static %}<img style="width: 16px; height: 16px; border: 0px; margin-left: 1px; margin-right: 1px;" src="{% static 'icons/' %}{{ relation.gigfinder }}.png" alt="{{ relation.gigfinder }}" />
                        </a>
                    </td>
                    <td style="max-width: 25ch; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        <a title="{{ relation.title }}" href="{% url 'concertannouncement_detail' relation.id %}">
                        {{ relation.title }} ({{ relation.date }})
                        </a>
                    </td>
                    <td style="max-width: 25ch; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        <a href="{% url 'venue_detail' relation.raw_venue.id %}">{{ relation.raw_venue }}</a>
                    </td>
                    <td>
                    {% if relation.far_from_concert %}
                        {% load static %}<img style="width: 25px; border: 0px; margin-left: 1px; margin-right: 1px;" src="{% static 'icons/danger.gif' %}" alt="GPS issue" title="GPS issue" />
                    {% endif %}
                    </td>
                    <td>
                    {% if not relation.raw_venue.organisation and not relation.raw_venue.non_assignable %}
                        {% load static %}<img style="width: 25px; border: 0px; margin-left: 1px; margin-right: 1px;" src="{% static 'icons/danger.gif' %}" alt="GPS issue" title="No related organisation" />
                    {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    {% endif %}

    <hr>

    <div style="margin-left:20px;margin-top:20px">
        <h4>Technical details</h4>
        <table border="1">
            <tr>
                <td>Cancelled</td>
                <td>{{ concert.cancelled }}</td>
            </tr>
            <tr>
                <td>Ignore</td>
                <td>{{ concert.ignore }}</td>
            </tr>
            <tr>
                <td>Verified</td>
                <td>{{ concert.verified }}</td>
            </tr>
            <tr>
                <td>Created at</td>
                <td>{{ concert.created_at }}</td>
            </tr>
            <tr>
                <td>Updated at</td>
                <td>{{ concert.updated_at }}</td>
            </tr>
        </table>
    </div>

    {% if concert.find_concurring_concerts.all %}
    <div style="margin-left:20px;margin-top:20px">
        <h4>Concerts on same day in same organisation</h4>
        <ul>
            {% for c in concert.find_concurring_concerts.all %}
                <li>
                    <a href="{% url 'concert_detail' c.id %}">
                    {% for relation in c.relationconcertartist_set.all %}
                        {{ relation.artist }}
                    {% endfor %}
                    </a>
                </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <hr>

    <div style="margin-left:20px;margin-top:20px">
        <h4>Actions</h4>
        <ul>
            {% if perms.hlwtadmin.can_update_concert %}<li><a href="{% url 'concert_update' concert.id %}">Update this concert</a></li>{% endif %}
            {% if perms.hlwtadmin.can_create_relationconcertorganisation %}<li><a href="{% url 'relationconcertorganisation_create' concert.id %}">Relate this concert to an organisation</a></li>{% endif %}
            {% if perms.hlwtadmin.can_create_relationconcertartist %}<li><a href="{% url 'relationconcertartist_create' concert.id %}">Relate this concert to an artist</a></li>{% endif %}
            {% if perms.hlwtadmin.can_create_relationartistartist %}<li><a href="{% url 'relationconcertconcert_create' concert.id %}">Relate concert to another concert</a></li>{% endif %}
        </ul>
    </div>
{% endblock %}